<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;' />
    <title>htmlspecialchars</title>
    <style>
        .specialchars {
        outline: 1px solid #ccc;
        word-break: break-all;
        padding: 4px;
        /*        font-size: 16px;
        line-height: 20px;*/
        cursor: pointer;
        display: flex;
        flex-wrap: wrap;
        margin-top: 30px;
        font-family: "Arial Unicode MS"
    }

    .specialchars .char {
        min-width: 20px;
        height: 40px;
        line-height: 40px;
        text-align: center;
    }


    .tip {
        position: absolute;
        text-align: center;
        overflow: hidden;
        font-weight: bolder;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    .tip[hide] {
        display: none;
    }

    .specialchars .char[active],
    .tip {
        color: red;
        outline: 1px solid #000;
        background: rgba(255, 255, 255, .8);
    }

    .tip div {
        flex: 1;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .tip .code {
        outline: 1px solid #000;
    }

    .tip .char {
        font-size: 25px;
        line-height: 25px;
        height: 25px;

    }

    .title {
        font-size: 20px;
        line-height: 20px;
        height: 20px;
    }

    .memo {
        font-size: 12px;
        color: #ccc;
    }
    </style>
</head>

<body>
    <div class="title">字符和编码</div>
    <div class="memo">
        HTML：&#十进制 CSS：\十六进制 JavaScript：\u十六进制 <br>
        Unicode 编码：将世界上所有的符号都纳入其中，包括英文、日文、中文 韩语等等
        希腊字母，西里尔文，亚美尼亚文，希伯来文
        <br>
        用四位16进制表示，范围在0 - 65535 之间。<br>
        Math.pow(16,4)=65536 <br>
        前128个字符就是ASCII码，之后是扩展码
        汉文，韩语，日语的象形文字占用从0X3000到0X9FFF的代码
        7位ASCII码是用七位二进制数进行编码的，可以表示128个字符
        第0～32号及第127号(共34个)是控制字符或通讯专用字符，如控制符：LF（换行）、CR（回车）、FF（换页）、DEL（删除）、BEL（振铃）等；
        通讯专用字符：SOH（文头）、EOT（文尾）、ACK（确认）等；
        第33～126号(共94个)是字符，其中第48～57号为0～9十个阿拉伯数字；65～90号为26个大写英文字母，97～122号为26个小写英文字母，其余为一些标点符号、运算符号等。
        一个ASCII码值占一个字节(8个二进制位)，其最高位(b7)用作奇偶校验位。所谓奇偶校验，是指在代码传送过程中用来检验是否出现错误的一种方法，一般分奇校验和偶校验两种。奇校验规定：正确的代码一个字节中1的个数必须是奇数，若非奇数，则在最高位b7添1；偶校验规定：正确的代码一个字节中1的个数必须是偶数，若非偶数，则在最高位b7添1。
        js方法<br>
        String.fromCharCode() 接受Unicode 值，返回字符串<br>
        StringObject.charCodeAt() 返回指定位置的字符的 Unicode 编码<br>
    </div>
    <div>
        起始编码 <br>
        十进制<input type="number" value="8672" size="10" name="code">          十六进制<input type="text" value="21E0" size="10" name="hexcode"><br>
        显示个数 <input type="number" value="1000" size="10" name="len"><br>
        <button class="run">提交</button>
    </div>
    <div class="specialchars">
    </div>
    <div class="tip"></div>
    <script>
    'use strict';

    document.write(Math.pow(16, 4))
    //定义类属性    方法不允许枚举
    var createClass = function() {
        function defineProperties(target, props) {
            for (var key in props) {
                if (target.hasOwnProperty(key)) {
                    console.log(_.type(target) + " hasOwnProperty " + key)
                } else {
                    //不覆盖已有属性
                    var descriptor = {
                        key: key,
                        value: props[key],
                        enumerable: false,
                        configurable: true,
                        writable: true
                    }
                    Object.defineProperty(target, key, descriptor);
                }
            }
        }
        return function(Constructor, protoProps, staticProps) {
            if (protoProps) defineProperties(Constructor.prototype, protoProps);
            if (staticProps) defineProperties(Constructor, staticProps);
            return Constructor;
        };
    }();
    //十进制转其他  
    // var x=110;  
    // alert(x);  
    // alert(x.toString(8));  
    // alert(x.toString(32));  
    // alert(x.toString(16));  
    // //其他转十进制  
    // var x='110';  
    // alert(parseInt(x,2));  
    // alert(parseInt(x,8));  
    // alert(parseInt(x,16));  
    // //其他转其他  
    // //先用parseInt转成十进制再用toString转到目标进制  
    // alert(String.fromCharCode(parseInt(141,8)))  
    // alert(parseInt('ff',16).toString(2));   

    var sc = document.querySelector(".specialchars")
    var createChars = function(start, len) {
        var frag = document.createDocumentFragment()
        for (var i = 0; i < len; i++) {
            var s = String.fromCharCode(start + i)
            var div = document.createElement("div")
            div.className = 'char'
            div.innerText = s
            frag.appendChild(div)
        }

        sc.innerHTML = ""
        sc.appendChild(frag)
    }


    var posinfo = function() {

        function Posinfo(el, limited) {
            if (!(this instanceof Posinfo)) return new Posinfo(el, limited);
            if (!el) {
                console.log("el is null")
                return false
            }
            var self = this;
            this.top = el.offsetTop;
            this.left = el.offsetLeft;
            var parent = el.offsetParent;
            while (parent) {
                this.left += parent.offsetLeft;
                this.top += parent.offsetTop;
                parent = parent.offsetParent;
            }
            this.height = el.offsetHeight;
            this.width = el.offsetWidth;


            // ["width", "height", "top", "left"].forEach(function(t) {
            //     self[t] = parseFloat(self.getStyle(el, t))
            // });

            this["minTop"] = -1 * parseFloat(this.getStyle(el, "margin-top"));
            this["minLeft"] = -1 * parseFloat(this.getStyle(el, "margin-left"));
            if (limited) {
                //     // x: document.documentElement.clientWidth,
                //     // y: document.documentElement.clientHeight
                this["maxTop"] = limited.height - this.height + this.minTop;
                this["maxLeft"] = limited.width - this.width + this.minLeft;
            }
        }

        return createClass(Posinfo, {
            getStyle: function(el, attr) {
                return window.getComputedStyle ? window.getComputedStyle(el, null)[attr] : el.currentStyle[attr]
            }
        })
    }();

    var addEvent = function(el, type, listener) {
        if (window.addEventListener) {
            el.addEventListener(type, listener, false);
        } else {
            el.attachEvent('on' + type, listener);
        }
    };

    var limited = posinfo(sc)
    console.log(limited)
    var tip = document.querySelector(".tip");

    var showTip = function(el, x, y) {
        var pos = posinfo(el)
        // console.log(pos)

        tip.removeAttribute("hide")
        var txt = el.innerText
        var code = txt.charCodeAt(0);
        var hex = code.toString(16).toUpperCase()
        // tip.innerHTML = txt + "<br>&#38;#" + code + "<br>\\u" + hex
        tip.innerHTML = ""
        var frag = document.createDocumentFragment();
        var div = document.createElement("div");
        div.className = "char"
        div.innerText = txt;
        frag.appendChild(div)

        var div = document.createElement("div");
        div.className = "code"
        div.innerText = "&#" + code;
        frag.appendChild(div)

        var div = document.createElement("div");
        div.className = "hex"
        div.innerText = "\\u" + hex
        frag.appendChild(div)
        tip.appendChild(frag);
        tip.style.width = pos.width * 5 + "px"
        tip.style.height = pos.height * 5 + "px"

        limited = posinfo(sc)
        // tip.style.left = Math.min(Math.max(pos.left - pos.width * 2, pos.left), limited.width - pos.width * 5) + "px"

        if (pos.left - pos.width * 2 <= 0) {
            tip.style.left = pos.left + "px"
        } else {
            if (pos.left + pos.width * 5 > limited.width) {
                tip.style.left = pos.left - pos.width * 4 + "px"
            } else {
                tip.style.left = pos.left - pos.width * 2 + "px"
            }

        }


        if (pos.top - pos.height * 5 >= 0) {
            tip.style.top = pos.top - pos.height * 5 + "px"
        } else {
            tip.style.top = pos.top + pos.height + "px"
        }
    }
    var hideTip = function() {
        var tip = document.querySelector(".tip");
        tip.setAttribute("hide", "")
    }

    // var el = document.querySelector(".specialchars")
    addEvent(document.body, "mousemove", function(e) {
        var e = e || event
        var offx = e.clientX,
            offy = e.clientY;

        var active = document.querySelector(".char[active]");
        active && active.removeAttribute("active")
        var char = e.target;
        if (char.className == "char") {
            char.setAttribute("active", "")
            showTip(char, offx, offy)
        } else {
            hideTip()
        }
    })

    createChars(8672, 1000)
    //data-bind
    var code=document.querySelector("input[name='code']")
    var hexcode=document.querySelector("input[name='hexcode']")
    var len = document.querySelector("input[name='len']")
    addEvent(code,"input",function(){
        hexcode.value=Number(this.value).toString(16).toUpperCase()
    })
     addEvent(hexcode,"input",function(){
        code.value=parseInt(this.value,16)
     })

    var btn = document.querySelector("button.run")
    addEvent(btn, "click", function() {
        // var code = document.querySelector("input[name='code']").value;
        // var len = document.querySelector("input[name='len']").value;
        createChars(Number(code.value), Number(len.value))
    })
    </script>
</body>

</html>